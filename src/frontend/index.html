<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>UniversoEspiritual — Preview</title>
    <style>
      body{font-family:system-ui,Arial;margin:20px}
      .box{max-width:900px;margin:auto}
      input,button,textarea{font-size:1rem;padding:6px;margin:4px}
      .row{display:flex;gap:8px;align-items:center}
      .item{border:1px solid #ddd;padding:8px;margin:6px 0}
      header{display:flex;justify-content:space-between;align-items:center}
    </style>
  </head>
  <body>
    <div class="box">
      <header>
        <h1>UniversoEspiritual — Preview</h1>
        <div>
          <label>Token: <input id="token" placeholder="optional token"/></label>
        </div>
      </header>

      <section>
        <h2>Crear usuario</h2>
        <div class="row">
          <input id="username" placeholder="username" />
          <input id="fullname" placeholder="full name" />
          <button id="create-user">Crear</button>
        </div>
        <pre id="user-result"></pre>
      </section>

      <section>
        <h2>Crear item</h2>
        <div class="row">
          <input id="item-name" placeholder="item name" />
          <input id="item-desc" placeholder="description" />
          <input id="item-owner" placeholder="owner_id (optional)" />
          <button id="create-item">Crear</button>
        </div>
        <pre id="item-result"></pre>
      </section>

      <section>
        <h2>Listar items</h2>
        <div class="row">
          <input id="q" placeholder="search q" />
          <input id="limit" placeholder="limit" value="20" style="width:80px" />
          <input id="offset" placeholder="offset" value="0" style="width:80px" />
          <button id="list">Listar</button>
        </div>
        <div id="items"></div>
      </section>
    </div>

    <script>
      const apiBase = '/api'
      const tokenInput = () => document.getElementById('token').value.trim()

      async function post(path, body){
        const headers = {'Content-Type':'application/json'}
        const token = tokenInput()
        if(token) headers['Authorization']= 'Bearer '+token
        const res = await fetch(apiBase+path, {method:'POST', headers, body: JSON.stringify(body)})
        return res
      }

      document.getElementById('create-user').onclick = async ()=>{
        const username = document.getElementById('username').value
        const full = document.getElementById('fullname').value
        const res = await post('/users',{username, full_name: full})
        document.getElementById('user-result').textContent = `${res.status} \n` + await res.text()
      }

      document.getElementById('create-item').onclick = async ()=>{
        const name = document.getElementById('item-name').value
        const desc = document.getElementById('item-desc').value
        const owner = document.getElementById('item-owner').value || undefined
        const body = {name, description: desc}
        if(owner) body.owner_id = Number(owner)
        const res = await post('/items', body)
        document.getElementById('item-result').textContent = `${res.status} \n` + await res.text()
      }

      document.getElementById('list').onclick = async ()=>{
        const q = document.getElementById('q').value
        const limit = document.getElementById('limit').value
        const offset = document.getElementById('offset').value
        const url = new URL(window.location.origin + apiBase + '/items')
        if(q) url.searchParams.set('q', q)
        if(limit) url.searchParams.set('limit', limit)
        if(offset) url.searchParams.set('offset', offset)
        const res = await fetch(url)
        const items = await res.json()
        const container = document.getElementById('items')
        container.innerHTML = ''
        items.forEach(it=>{
          const d = document.createElement('div')
          d.className='item'
          d.textContent = JSON.stringify(it)
          container.appendChild(d)
        })
      }
    </script>
  </body>
</html>
